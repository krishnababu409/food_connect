extends layout.pug

block navbar
  include mainbar.pug

block content
  main
    .container.py-5
      .bg-light.p-4.p-lg-5.rounded-4.shadow-sm
        .d-flex.flex-column.flex-lg-row.align-items-lg-center.justify-content-between.gap-3
          div
            h1.display-5.fw-bold.mb-1 Dashboard
            p.lead.text-muted.mb-0 Manage your donations and track activity from here.

      if stats
        .row.g-3.mt-4
          .col-md-3.col-sm-6
            .card.shadow-sm.border-0.h-100
              .card-body
                .text-muted.text-uppercase.small Total
                .fs-3.fw-bold= stats.total
          .col-md-3.col-sm-6
            .card.shadow-sm.border-0.h-100
              .card-body
                .text-muted.text-uppercase.small Available
                .fs-3.fw-bold.text-success= stats.available
          .col-md-3.col-sm-6
            .card.shadow-sm.border-0.h-100
              .card-body
                .text-muted.text-uppercase.small Claimed
                .fs-3.fw-bold.text-warning= stats.claimed
          .col-md-3.col-sm-6
            .card.shadow-sm.border-0.h-100
              .card-body
                .text-muted.text-uppercase.small Completed
                .fs-3.fw-bold.text-primary= stats.completed

      // Filters and search
      .bg-white.border.rounded-4.shadow-sm.mt-4
        form#filtersForm(class='p-3 p-lg-4 d-flex flex-column flex-lg-row align-items-lg-end gap-3' method='get' action='/dashboard')
          .flex-grow-1
            label.form-label(for='q') Search
            input#q.form-control(type='search' name='q' placeholder='Search donor or food item' value=searchQuery)
          .flex-grow-0
            label.form-label(for='status') Status
            select#status.form-select(name='status')
              option(value='all' selected=(statusFilter === 'all')) All
              option(value='Available' selected=(statusFilter === 'Available')) Available
              option(value='Claimed' selected=(statusFilter === 'Claimed')) Claimed
              option(value='Completed' selected=(statusFilter === 'Completed')) Completed
          .d-flex.gap-2
            button.btn.btn-primary(type='submit') Apply
            a.btn.btn-outline-secondary(href='/dashboard' role='button') Reset

      if donations && donations.length
        .table-responsive.mt-4
          table.table.table-striped.table-hover.align-middle.shadow-sm
            thead.table-dark
              tr
                th(scope='col') Donor
                th(scope='col') Food Item
                th(scope='col') Quantity
                th(scope='col') Pickup Time
                th(scope='col') Status
                th(scope='col') Added
            tbody
              each donation in donations
                - const statusClass = donation.status === 'Available' ? 'bg-success' : donation.status === 'Claimed' ? 'bg-warning text-dark' : 'bg-primary'
                tr.donation-row(role='button' tabindex='0' data-href=`/donations/${donation.id}`)
                  td.fw-semibold= donation.donor_name
                  td= donation.food_item
                  td= donation.quantity
                  td= donation.pickup_time
                  td
                    span.badge(class=statusClass)= donation.status
                  td.text-muted= donation.created_at
      else
        .alert.alert-info.mt-4.shadow-sm No donations match your filters. Try adjusting search or status.

      .mt-4.d-flex.justify-content-end.align-items-center
        a.btn.btn-primary(href='/register') Add Donation

    if donations && donations.length
      script.
        (function() {
          const rows = document.querySelectorAll('.donation-row');
          rows.forEach((row) => {
            const href = row.dataset.href;
            if (!href) return;
            row.addEventListener('click', () => window.location = href);
            row.addEventListener('keypress', (event) => {
              if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                window.location = href;
              }
            });
          });
        })();
